require 'azure'
Azure.configure do |config|
  config.management_certificate  = ENV["AZURE_MANAGEMENT_CERTIFICATE"]
  config.subscription_id         = ENV["AZURE_SUBSCRIPTION_ID"]
  config.management_endpoint     = ENV["AZURE_MANAGEMENT_ENDPOINT"]
end
virtual_network = Azure::VirtualNetworkManagementService.new
vnet_name = '<%=@virtual_network_name%>'
affinity_group_name = '<%=@affinity_group_name%>'
address_space = <%=@address_space%>
options = {
  :subnet => <%=@subnets || []%>,
  :dns => <%=@dns_servers || []%>
  }
virtual_network.set_network_configuration(vnet_name, affinity_group_name, address_space, options)